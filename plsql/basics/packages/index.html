<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=/css/superkube.min.css><link rel=stylesheet href=/css/main.css><script>var clicky_site_ids=clicky_site_ids||[];clicky_site_ids.push(101305633)</script><script async src=//static.getclicky.com/js></script><title>Учебник Oracle SQL, PL/SQL | Пакеты</title></head><body><div class="navbar bg-dark mb-10"><div class="navbar-container container edges centered"><div class=navbar-brand><a href=/ class=brand>Orasql.ru</a></div><div class="navbar-nav ml-6"><nav class="nav nav-light nav-semibold"><ul class=nav-list><li class=nav-item><a href=/book/ class=nav-link>Книга</a></li></ul></nav><nav class="nav nav-light nav-semibold"><ul class=nav-list><li class=nav-item><a href=https://github.com/cyevgeniy/orasqlru class=nav-link>Github</a></li></ul></nav></div></div></div><div id=container class="container-medium edges centered"><div class="doc-head mb-4 container-10"><h5 class="heading-micro heading-muted">Основы PL/SQL</h5><h1 class="heading-huge heading-heavy">Пакеты</h1></div><div class="doc-toc mt-6 mb-6"><nav class="menu menu-underline menu-medium menu-numbered"><ul class=menu-list><li class=menu-item><a href=#%d1%81%d1%82%d1%83%d0%ba%d1%82%d1%83%d1%80%d0%b0-%d0%bf%d0%b0%d0%ba%d0%b5%d1%82%d0%b0 class=menu-link>Стуктура пакета</a></li><li class=menu-item><a href=#%d1%81%d0%be%d0%b7%d0%b4%d0%b0%d0%bd%d0%b8%d0%b5-%d0%bf%d0%b0%d0%ba%d0%b5%d1%82%d0%b0 class=menu-link>Создание пакета</a></li><li class=menu-item><a href=#%d1%83%d0%b4%d0%b0%d0%bb%d0%b5%d0%bd%d0%b8%d0%b5-%d0%bf%d0%b0%d0%ba%d0%b5%d1%82%d0%b0 class=menu-link>Удаление пакета</a></li><li class=menu-item><a href=#%d0%ba%d0%be%d0%bc%d0%bf%d0%b8%d0%bb%d1%8f%d1%86%d0%b8%d1%8f-%d0%bf%d0%b0%d0%ba%d0%b5%d1%82%d0%b0 class=menu-link>Компиляция пакета</a></li><li class=menu-item><a href=#%d0%b8%d0%b7%d0%bc%d0%b5%d0%bd%d0%b5%d0%bd%d0%b8%d0%b5-%d0%bf%d0%b0%d0%ba%d0%b5%d1%82%d0%b0 class=menu-link>Изменение пакета</a></li><li class=menu-item><a href=#%d0%bf%d0%b0%d0%ba%d0%b5%d1%82%d1%8b-%d0%b1%d0%b5%d0%b7-%d1%82%d0%b5%d0%bb%d0%b0 class=menu-link>Пакеты без тела</a></li><li class=menu-item><a href=#%d0%bf%d0%b5%d1%80%d0%b5%d0%b3%d1%80%d1%83%d0%b7%d0%ba%d0%b0-%d0%bf%d1%80%d0%be%d1%86%d0%b5%d0%b4%d1%83%d1%80-%d0%b8-%d1%84%d1%83%d0%bd%d0%ba%d1%86%d0%b8%d0%b9 class=menu-link>Перегрузка процедур и функций</a></li><li class=menu-item><a href=#%d1%81%d0%b5%d1%81%d1%81%d0%b8%d0%b8-%d0%b8-%d1%81%d0%be%d1%81%d1%82%d0%be%d1%8f%d0%bd%d0%b8%d1%8f class=menu-link>Сессии и состояния</a></li><li class=menu-item><a href=#%d0%bf%d0%be%d1%80%d1%8f%d0%b4%d0%be%d0%ba-%d0%b7%d0%b0%d0%b3%d1%80%d1%83%d0%b7%d0%ba%d0%b8-%d0%bf%d0%b0%d0%ba%d0%b5%d1%82%d0%b0-%d0%b2-%d0%bf%d0%b0%d0%bc%d1%8f%d1%82%d1%8c class=menu-link>Порядок загрузки пакета в память</a></li><li class=menu-item><a href=#%d0%b1%d0%bb%d0%be%d0%ba-%d0%b8%d0%bd%d0%b8%d1%86%d0%b8%d0%b0%d0%bb%d0%b8%d0%b7%d0%b0%d1%86%d0%b8%d0%b8 class=menu-link>Блок инициализации</a></li><li class=menu-item><a href=#%d0%b5%d1%89%d1%91-%d0%be-%d1%84%d1%83%d0%bd%d0%ba%d1%86%d0%b8%d1%8f%d1%85-%d0%b2-%d0%bf%d0%b0%d0%ba%d0%b5%d1%82%d0%b0%d1%85 class=menu-link>Ещё о функциях в пакетах</a></li></ul></nav></div><p>В данной части будут рассмотрены пакеты - основная сущность
при разработке на PL/SQL. Пакеты используются для группировки
функционала в именованные модули с возможностью разделения
интерфейса и реализации. На самом деле, мы уже сталкивались
с ними, когда рассматривали вывод на экран с использованием
<code>dbms_output.put_line</code>. <code>Dbms_output</code> - это пакет, а <code>put_line</code> -
процедура, объявленная в данном пакете.</p><h2 id=стуктура-пакета>Стуктура пакета</h2><p>Пакеты как правило состоят из <strong>спецификации</strong> и <strong>тела</strong>.
Можно создать пакет без тела, только со спецификацией, такой
вариант использования тоже будет рассмотрен.</p><p>Спецификация пакета - это то, к чему можно обращаться при
работе с пакетом. В спецификации могут быть объявлены
типы, переменные, константы, сигнатуры процедур и функций.</p><p>Тело пакета содержит в себе код, необходимый для
реализации спецификации. Также он может содержать всё то же, что
спецификация - переменные, типы, константы и проч. Всё, что
содержится в теле, но не описано в спецификации, недоступно
для использования внешними модулями. Здесь можно провести аналогию
с публичными и приватными модификаторами доступа в ООП языках(
например, как <code>private</code> и <code>public</code> в Java).</p><p><img src=/img/plsql/package_structure.png alt></p><h2 id=создание-пакета>Создание пакета</h2><p>Общий синтаксис создания спецификации пакета выглядит
так:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>create</span><span style=color:#bbb> </span>package<span style=color:#bbb> </span>pck_utils<span style=color:#bbb> </span><span style=color:#000;font-weight:700>as</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#998;font-style:italic>-- Specification code
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#000;font-weight:700>end</span><span style=color:#bbb> </span>pck_utils;<span style=color:#bbb>
</span></span></span></code></pre></div><p>Команда выше создаст пакет с названием <code>pck_utils</code>. Если
пакет с таким именем уже существует, будет выброшена ошибка,
и новый пакет не создастся. Чтобы заменить уже существующий
пакет, используется команда <code>create or replace</code>. На практике чаще
всего используют именно её:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>create</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>or</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>replace</span><span style=color:#bbb> </span>package<span style=color:#bbb> </span>pck_utils<span style=color:#bbb> </span><span style=color:#000;font-weight:700>as</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#998;font-style:italic>-- Specification code
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#000;font-weight:700>end</span><span style=color:#bbb> </span>pck_utils;<span style=color:#bbb>
</span></span></span></code></pre></div><p>Тело пакета создаётся следующим образом:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>create</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>or</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>replace</span><span style=color:#bbb> </span>package<span style=color:#bbb> </span>body<span style=color:#bbb> </span>pck_utils<span style=color:#bbb> </span><span style=color:#000;font-weight:700>as</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#998;font-style:italic>-- Specification code
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#000;font-weight:700>end</span><span style=color:#bbb> </span>pck_utils;<span style=color:#bbb>
</span></span></span></code></pre></div><p>Давайте создадим пакет и наполним его каким-нибудь функционалом:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>create</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>or</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>replace</span><span style=color:#bbb> </span>package<span style=color:#bbb> </span>pck_date_utils<span style=color:#bbb> </span><span style=color:#000;font-weight:700>as</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#998;font-style:italic>-- Возвращает максимальную дату, 
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic>-- используемую в системе
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#000;font-weight:700>function</span><span style=color:#bbb> </span>maxdate<span style=color:#bbb> </span><span style=color:#000;font-weight:700>return</span><span style=color:#bbb> </span><span style=color:#0086b3>date</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#998;font-style:italic>-- Возвращает минимальную дату, 
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic>-- используемую в системе
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#000;font-weight:700>function</span><span style=color:#bbb> </span>mindate<span style=color:#bbb> </span><span style=color:#000;font-weight:700>return</span><span style=color:#bbb> </span><span style=color:#0086b3>date</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#998;font-style:italic>-- Добавляет указанное количество недель к
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic>-- указанной дате. Для того, чтобы отнять
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic>-- недели, нужно передать отрицательное число
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#000;font-weight:700>function</span><span style=color:#bbb> </span>add_weeks(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>pdate<span style=color:#bbb> </span><span style=color:#0086b3>date</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>pweeks<span style=color:#bbb> </span><span style=color:#0086b3>number</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>return</span><span style=color:#bbb> </span><span style=color:#0086b3>date</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>end</span><span style=color:#bbb> </span>pck_date_utils;<span style=color:#bbb>
</span></span></span></code></pre></div><p>Это была спецификация пакета. Теперь создадим тело:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>create</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>or</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>replace</span><span style=color:#bbb> </span>package<span style=color:#bbb> </span>body<span style=color:#bbb> </span>pck_date_utils<span style=color:#bbb> </span><span style=color:#000;font-weight:700>as</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>function</span><span style=color:#bbb> </span>maxdate<span style=color:#bbb> </span><span style=color:#000;font-weight:700>return</span><span style=color:#bbb> </span><span style=color:#0086b3>date</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>is</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>begin</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>return</span><span style=color:#bbb> </span>to_date(<span style=color:#d14>&#39;4000.01.01&#39;</span>,<span style=color:#bbb> </span><span style=color:#d14>&#39;yyyy.mm.dd&#39;</span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>end</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>function</span><span style=color:#bbb> </span>mindate<span style=color:#bbb> </span><span style=color:#000;font-weight:700>return</span><span style=color:#bbb> </span><span style=color:#0086b3>date</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>is</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>begin</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>return</span><span style=color:#bbb> </span>to_date(<span style=color:#d14>&#39;1800.01.01&#39;</span>,<span style=color:#bbb> </span><span style=color:#d14>&#39;yyyy.mm.dd&#39;</span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>end</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>function</span><span style=color:#bbb> </span>add_weeks(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>pdate<span style=color:#bbb> </span><span style=color:#0086b3>date</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>pweeks<span style=color:#bbb> </span><span style=color:#0086b3>number</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>return</span><span style=color:#bbb> </span><span style=color:#0086b3>date</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>is</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>begin</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>return</span><span style=color:#bbb> </span>pdate<span style=color:#bbb> </span><span style=color:#000;font-weight:700>+</span><span style=color:#bbb> </span>(<span style=color:#099>7</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>*</span><span style=color:#bbb> </span>pweeks);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>end</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>end</span><span style=color:#bbb> </span>pck_date_utils;<span style=color:#bbb>
</span></span></span></code></pre></div><p>Теперь мы можем обращаться ко всему, что объявлено
в спецификации пакета в нашем коде. Обращение к содержимому
пакета осуществляется в виде <code>имя_пакета.объект</code>(под объектом
понимается всё, что объявлено в спецификации):</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>begin</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>dbms_output.put_line(to_char(pck_date_utils.mindate,<span style=color:#bbb> </span><span style=color:#d14>&#39;yyyy.mm.dd&#39;</span>));<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>dbms_output.put_line(to_char(pck_date_utils.maxdate,<span style=color:#bbb> </span><span style=color:#d14>&#39;yyyy.mm.dd&#39;</span>));<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>dbms_output.put_line(to_char(pck_date_utils.add_weeks(sysdate,<span style=color:#bbb> </span><span style=color:#099>3</span>),<span style=color:#bbb> </span><span style=color:#d14>&#39;yyyy.mm.dd&#39;</span>));<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>end</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p>Вывод:</p><pre tabindex=0><code>1800.01.01
4000.01.01
2022.03.30
</code></pre><h2 id=удаление-пакета>Удаление пакета</h2><p>Удаление производится командой <code>drop package</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>drop</span><span style=color:#bbb> </span>package<span style=color:#bbb> </span>pck_date_utils<span style=color:#bbb>
</span></span></span></code></pre></div><h2 id=компиляция-пакета>Компиляция пакета</h2><p>В учебнике мы предполагаем, что текст пакета должен храниться в <em>файлах</em>,
как SQL скрипты. Спецификацию и тело, как правило, хранят в разных файлах,
с расширениями &ldquo;.sql&rdquo;. Можно использовать любые другие расширения, например
&ldquo;.pks&rdquo; для спецификации и &ldquo;.pkb&rdquo; для тела - подобные расширения также часто
используются. Когда нужно изменить пакет, код в этих файлах меняется,
после чего эти скрипты перезапускаются.</p><p>Если нужно произвести перекомпиляцию пакета, который уже создан,
без его изменения, можно воспользоваться командой <code>alter package</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>alter</span><span style=color:#bbb> </span>package<span style=color:#bbb> </span>pck_utils<span style=color:#bbb> </span>compile<span style=color:#bbb> </span>package;<span style=color:#bbb>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>alter</span><span style=color:#bbb> </span>package<span style=color:#bbb> </span>pck_utils<span style=color:#bbb> </span>compile<span style=color:#bbb> </span>specification;<span style=color:#bbb>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>alter</span><span style=color:#bbb> </span>package<span style=color:#bbb> </span>pck_utils<span style=color:#bbb> </span>compile<span style=color:#bbb> </span>body;<span style=color:#bbb>
</span></span></span></code></pre></div><h2 id=изменение-пакета>Изменение пакета</h2><p>Изменение пакета производится путём перекомпиляции
его спецификации или тела(используя <code>create or replace</code>).</p><p>Если спецификация пакета не изменяется, а только её реализация,
то её пересоздавать не нужно. Если же меняется и спецификация,
то придётся перекомпилировать и спецификацию, и тело.</p><h2 id=пакеты-без-тела>Пакеты без тела</h2><p>Можно создать пакет, который не будет иметь тела.
Как правило, это пакеты, которые содержат публичные
константы, типы или переменные:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>create</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>or</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>replace</span><span style=color:#bbb> </span>package<span style=color:#bbb> </span>pck_user_gl<span style=color:#bbb> </span><span style=color:#000;font-weight:700>as</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#998;font-style:italic>-- Статусы пользователей
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span>active<span style=color:#bbb> </span>constant<span style=color:#bbb> </span><span style=color:#0086b3>number</span><span style=color:#bbb> </span>:<span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span><span style=color:#099>0</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>deleted<span style=color:#bbb> </span>constant<span style=color:#bbb> </span><span style=color:#0086b3>number</span><span style=color:#bbb> </span>:<span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span><span style=color:#099>1</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>paused<span style=color:#bbb> </span>constant<span style=color:#bbb> </span><span style=color:#0086b3>number</span><span style=color:#bbb> </span>:<span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span><span style=color:#099>2</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>end</span><span style=color:#bbb> </span>pck_user_gl;<span style=color:#bbb>
</span></span></span></code></pre></div><p>В данном пакете содержатся константы для
описания статусов пользователей.
Теперь мы можем обращаться к статусам, объявленным в пакете:</p><pre tabindex=0><code>-- Выведет три строки:
-- 0
-- 2
-- 1
begin
    dbms_output.put_line(pck_user_gl.active);
    dbms_output.put_line(pck_user_gl.paused);
    dbms_output.put_line(pck_user_gl.deleted);
end;
</code></pre><p>Напомним, что констатны и переменные PL/SQL нельзя использовать в SQL запросах,
но они могут быть использованы в другом PL/SQL коде.</p><h2 id=перегрузка-процедур-и-функций>Перегрузка процедур и функций</h2><p>Внутри пакета можно объявить несколько функций
или процедур с одним и тем же именем, но с разной
сигнатурой. Подобная возможность в языках программирования
называется перегрузкой(overloading). Простейший пример
перегруженных функций(процедур) - это <code>dbms_output.put_line</code>.
Мы можем вызывать данную процедуру как со строками, так и с
датами или числами. Создадим свой пакет для вывода информации
на экран, только с более коротким именем процедуры, для удобной
работы:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>create</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>or</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>replace</span><span style=color:#bbb> </span>package<span style=color:#bbb> </span>pck_output<span style=color:#bbb> </span><span style=color:#000;font-weight:700>as</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>procedure</span><span style=color:#bbb> </span>print(v<span style=color:#bbb> </span>varchar2);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>procedure</span><span style=color:#bbb> </span>print(v<span style=color:#bbb> </span><span style=color:#0086b3>number</span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>procedure</span><span style=color:#bbb> </span>print(v<span style=color:#bbb> </span><span style=color:#0086b3>date</span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>end</span><span style=color:#bbb> </span>pck_output;<span style=color:#bbb>
</span></span></span></code></pre></div><p>В спецификации мы объявили три разных сигнатуры - несмотря на то,
что имена у них одинаковые, они отличаются типами принимаемых аргументов.
Теперь создадим тело пакета:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>create</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>or</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>replace</span><span style=color:#bbb> </span>package<span style=color:#bbb> </span>body<span style=color:#bbb> </span>pck_output<span style=color:#bbb> </span><span style=color:#000;font-weight:700>as</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>procedure</span><span style=color:#bbb> </span>print(v<span style=color:#bbb> </span>varchar2)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>is</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>begin</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>dbms_output.put_line(v);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>end</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>procedure</span><span style=color:#bbb> </span>print(v<span style=color:#bbb> </span><span style=color:#0086b3>number</span>)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>is</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>begin</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>dbms_output.put_line(v);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>end</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>procedure</span><span style=color:#bbb> </span>print(v<span style=color:#bbb> </span><span style=color:#0086b3>date</span>)<span style=color:#bbb> </span><span style=color:#000;font-weight:700>is</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>begin</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>dbms_output.put_line(v);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>end</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>end</span><span style=color:#bbb> </span>pck_output;<span style=color:#bbb>
</span></span></span></code></pre></div><p>Скомпилируем пакет и проверим, как он работает:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#998;font-style:italic>-- Выведет строки:
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic>-- 19-MAR-22
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic>-- 34.23
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic>-- Hello, World
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#000;font-weight:700>declare</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>v1<span style=color:#bbb> </span><span style=color:#0086b3>date</span><span style=color:#bbb> </span>:<span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span>sysdate;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>v2<span style=color:#bbb> </span><span style=color:#0086b3>number</span><span style=color:#bbb> </span>:<span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span><span style=color:#099>34</span>.<span style=color:#099>23</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>v3<span style=color:#bbb> </span>varchar2(<span style=color:#099>20</span>)<span style=color:#bbb> </span>:<span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span><span style=color:#d14>&#39;Hello, World&#39;</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>begin</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>pck_output.print(v1);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>pck_output.print(v2);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>pck_output.print(v3);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>end</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p>Функции можно перегружать, если они отличаются</p><ul><li>Количеством аргументов</li><li>Типами аргументов</li></ul><p>Имена аргументов при этом не важны - не получится создать две процедуры вида:</p><pre tabindex=0><code>procedure proc1(name varchar2);
procedure proc1(username varchar2);
</code></pre><p>Но зато получится создать такие процедуры:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>procedure</span><span style=color:#bbb> </span>proc1(name<span style=color:#bbb> </span>varchar2);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#998;font-style:italic>-- Отличается от предыдущей количеством аргументов
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#000;font-weight:700>procedure</span><span style=color:#bbb> </span>proc1(name<span style=color:#bbb> </span>varchar2,<span style=color:#bbb> </span><span style=color:#000;font-weight:700>trim</span>:<span style=color:#bbb> </span><span style=color:#0086b3>boolean</span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#998;font-style:italic>-- отличается от предыдущей типами аргументов
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#000;font-weight:700>procedure</span><span style=color:#bbb> </span>proc1(name<span style=color:#bbb> </span>varchar2,<span style=color:#bbb> </span><span style=color:#000;font-weight:700>trim</span>:<span style=color:#bbb> </span><span style=color:#0086b3>number</span>);<span style=color:#bbb>
</span></span></span></code></pre></div><h2 id=сессии-и-состояния>Сессии и состояния</h2><p>Каждая сессия в БД работает со своей копией пакета в памяти, что
означает, что состояние переменных пакета <em>локально для сессии,
использующей его</em>. Рассмотрим простой пример:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>create</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>or</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>replace</span><span style=color:#bbb> </span>package<span style=color:#bbb> </span>pck_test<span style=color:#bbb> </span><span style=color:#000;font-weight:700>as</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>current_number<span style=color:#bbb> </span><span style=color:#0086b3>number</span><span style=color:#bbb> </span>:<span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span><span style=color:#099>10</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>end</span><span style=color:#bbb> </span>pck_test;<span style=color:#bbb>
</span></span></span></code></pre></div><p>Пакет содержит одну переменную <code>current_number</code>
со значением по-умолчанию, равным 10. Предположим, с пакетом будут
работать две сессии, А и Б:</p><p>Сессия А:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>begin</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>dbms_output.put_line(pck_test.current_number);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>end</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p>Сессия Б:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>begin</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>dbms_output.put_line(pck_test.current_number);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>end</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p>Результат будет одинаковым в двух сессиях:</p><pre tabindex=0><code>10
</code></pre><p>Теперь изменим значение переменной в первой сессии:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#998;font-style:italic>-- Сессия А
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#000;font-weight:700>begin</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>pck_test.current_number<span style=color:#bbb> </span>:<span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span><span style=color:#099>20</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>end</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p>После чего выведем содержимое переменной в двух сессиях:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#998;font-style:italic>-- Сессия А:
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#000;font-weight:700>begin</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>dbms_output.put_line(pck_test.current_number);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>end</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#998;font-style:italic>-- Сессия Б:
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#000;font-weight:700>begin</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>dbms_output.put_line(pck_test.current_number);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>end</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p>И получим следующий результат:</p><p>Сессия А:</p><pre tabindex=0><code>20
</code></pre><p>Сессия Б:</p><pre tabindex=0><code>10
</code></pre><p>Как видно, изменения переменной, произведённые в первой сессии,
не повлияли на значение той же переменной пакета во второй сессии.</p><p>Если в пакете объявлена хотя бы одна переменная, константа, или курсор(не важно где,
в теле пакета или в его спецификации), то пакет обладает <em>состоянием</em>. Когда Oracle
создаёт экземпляр пакета, в сессии также хранится и состояние. Изменения в состоянии пакета
сохраняются на всё время работы сессии(за исключением пакетов, объявленных как <code>SERIALLY_REUSABLE</code>,
это будет будет рассмотрено в отдельной части). Но состояние может быть сброшено, если пакет
был перекомпилирован.</p><p>Сброс состояния означает, что изменения, произведённые с переменными
или курсорами, будут утеряны, и оракл выбросит ошибку с сообщением о том,
что состояние пакета было сброшено. Способы уменьшения вероятности сброса состояния
будут рассмотрены в отдельной части, посвящённой продвинутой работе с пакетами.</p><h2 id=порядок-загрузки-пакета-в-память>Порядок загрузки пакета в память</h2><p>Помимо создания экземпляра пакета в памяти при первоначальном
обращении к нему, Oracle производит его инициализацию, состоящую
из следующих шагов:</p><ul><li>Присваивание первоначальных значений публичным константам</li><li>Присваивание первоначальных значений публичным переменным</li><li>Запуск блока инициализации</li></ul><h2 id=блок-инициализации>Блок инициализации</h2><p>Блок инициализации добавляется в конце тела пакета
между ключевым словом <code>begin</code> и конструкцией <code>end package_name</code>, и как правило используется
для присваивания начальных значений переменным пакета. Сам блок является необязательным.
Рассмотрим пример пакета с блоком инициализации:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#998;font-style:italic>-- Спецификация пакета
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#000;font-weight:700>create</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>or</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>replace</span><span style=color:#bbb> </span>package<span style=color:#bbb> </span>pck_init<span style=color:#bbb> </span><span style=color:#000;font-weight:700>as</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>init_val<span style=color:#bbb> </span><span style=color:#0086b3>number</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>procedure</span><span style=color:#bbb> </span>say_hello;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>end</span><span style=color:#bbb> </span>pck_init;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>/</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#998;font-style:italic>-- Тело пакета
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#000;font-weight:700>create</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>or</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>replace</span><span style=color:#bbb> </span>package<span style=color:#bbb> </span>body<span style=color:#bbb> </span>pck_init<span style=color:#bbb> </span><span style=color:#000;font-weight:700>as</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>procedure</span><span style=color:#bbb> </span>say_hello<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>is</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>begin</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>dbms_output.put_line(<span style=color:#d14>&#39;Привет, Мир!&#39;</span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>end</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#998;font-style:italic>--Секция инициализации
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#000;font-weight:700>begin</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>dbms_output.put_line(<span style=color:#d14>&#39;Инициализация пакета&#39;</span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>init_val<span style=color:#bbb> </span>:<span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span><span style=color:#099>23</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>end</span><span style=color:#bbb> </span>pck_init;<span style=color:#bbb>
</span></span></span></code></pre></div><p>Теперь вызовем процедуру <code>say_hello</code> несколько раз подряд:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>begin</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>pck_init.say_hello();<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>pck_init.say_hello();<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>pck_init.say_hello();<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>end</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p>Результат:</p><pre tabindex=0><code>Инициализация пакета
Привет, Мир!
Привет, Мир!
Привет, Мир!
</code></pre><p>Как видно, при первом обращении к пакету был вызван блок
инициализации, причём до выполнения процедуры <code>say_hello</code>.
При последующих обращениях к пакету инициализация не
производится. Инициализация выполняется при любом первичном
обращении к пакету, это не обязательно должна быть процедура
или функция:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>begin</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#998;font-style:italic>-- Выведет две строки:
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#bbb>    </span><span style=color:#998;font-style:italic>-- Инициализация пакета
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#bbb>    </span><span style=color:#998;font-style:italic>-- 23
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#bbb>    </span>dbms_output.put_line(pck_init.init_val);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>end</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p>Считается правилом хорошего тона производить инициалиацию всех
переменных именно в блоке инициализации, а не при объявлении переменных.
Одна из причин - тот факт, что ошибки, которые могут возникнуть при инициализации переменных,
можно отловить только здесь. Исключения будут рассмотрены позже, но для быстрого ознакомления
приведём пример:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>create</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>or</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>replace</span><span style=color:#bbb> </span>package<span style=color:#bbb> </span>pck_test<span style=color:#bbb> </span><span style=color:#000;font-weight:700>is</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>min_age<span style=color:#bbb> </span><span style=color:#0086b3>number</span>(<span style=color:#099>2</span>)<span style=color:#bbb> </span>:<span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span><span style=color:#099>123</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>default_name<span style=color:#bbb> </span>varchar2(<span style=color:#099>3</span><span style=color:#bbb> </span><span style=color:#0086b3>char</span>)<span style=color:#bbb> </span>:<span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span><span style=color:#d14>&#39;User&#39;</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>end</span><span style=color:#bbb> </span>pck_test;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>/</span><span style=color:#bbb>
</span></span></span></code></pre></div><p>При создании пакета не будет выдани никаких сообщений об ошибке.
Но если мы попробуем вывести на экран значение <code>default_name</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>begin</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>dbms_output.put_line(pck_test.default_name);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>end</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p>То получим ошибку(Во время выполнения!) <code>ORA-06502: PL/SQL: numeric or value error: number precision too large ORA-06512</code>.
А при использовании блока инициализации ошибку можно отловить:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>create</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>or</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>replace</span><span style=color:#bbb> </span>package<span style=color:#bbb> </span>pck_test<span style=color:#bbb> </span><span style=color:#000;font-weight:700>is</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>min_age<span style=color:#bbb> </span><span style=color:#0086b3>number</span>(<span style=color:#099>2</span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>default_name<span style=color:#bbb> </span>varchar2(<span style=color:#099>3</span><span style=color:#bbb> </span><span style=color:#0086b3>char</span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>end</span><span style=color:#bbb> </span>pck_test;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>/</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>create</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>or</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>replace</span><span style=color:#bbb> </span>package<span style=color:#bbb> </span>body<span style=color:#bbb> </span>pck_test<span style=color:#bbb> </span><span style=color:#000;font-weight:700>is</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>begin</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>min_age<span style=color:#bbb> </span>:<span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span><span style=color:#099>123</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>default_name<span style=color:#bbb> </span>:<span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span><span style=color:#d14>&#39;User&#39;</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>exception</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>when</span><span style=color:#bbb> </span>value_error<span style=color:#bbb> </span><span style=color:#000;font-weight:700>then</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>min_age<span style=color:#bbb> </span>:<span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span><span style=color:#099>18</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>default_name<span style=color:#bbb> </span>:<span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span><span style=color:#d14>&#39;NIL&#39;</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>end</span><span style=color:#bbb> </span>pck_test;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>/</span><span style=color:#bbb>
</span></span></span></code></pre></div><p>В этот раз мы имеем возможность отловить все ошибки на стадии инициализации
пакета и предпринять нужные меры. Посмотрим, как это работает:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#998;font-style:italic>-- Выведет две строки:
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic>-- NIL
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic>-- 18
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#000;font-weight:700>begin</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>dbms_output.put_line(pck_test.default_name);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>end</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><h2 id=ещё-о-функциях-в-пакетах>Ещё о функциях в пакетах</h2><h3 id=forward-declaration>Forward declaration</h3><p>Порядок приватных функций/процедур в теле пакета имеет значение.
Если функция <code>A</code> использует функцию <code>B</code>, то функция <code>B</code> к тому моменту
должна быть объявлена, то есть находиться выше в коде тела:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>create</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>or</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>replace</span><span style=color:#bbb> </span>package<span style=color:#bbb> </span>pck_test<span style=color:#bbb> </span><span style=color:#000;font-weight:700>as</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>procedure</span><span style=color:#bbb> </span>print_hello;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>end</span><span style=color:#bbb> </span>pck_test;<span style=color:#bbb>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>create</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>or</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>replace</span><span style=color:#bbb> </span>package<span style=color:#bbb> </span>body<span style=color:#bbb> </span>pck_test<span style=color:#bbb> </span><span style=color:#000;font-weight:700>as</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>procedure</span><span style=color:#bbb> </span>print_hello<span style=color:#bbb> </span><span style=color:#000;font-weight:700>is</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>begin</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>dbms_output.put_line(get_hello_message);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>end</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>function</span><span style=color:#bbb> </span>get_hello_message<span style=color:#bbb> </span><span style=color:#000;font-weight:700>return</span><span style=color:#bbb> </span>varchar2<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>is</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>begin</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>return</span><span style=color:#bbb> </span><span style=color:#d14>&#39;Hello, World!&#39;</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>end</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>end</span><span style=color:#bbb> </span>pck_test;<span style=color:#bbb>
</span></span></span></code></pre></div><p>Здесь процедура <code>print_hello</code> выводит на экран текст сообщения, который
возвращает функция <code>get_hello_message</code>, но сама процедура объявлена раньше, чем функция.
При компиляции тела мы получим ошибку <code>PLS-00313: 'GET_HELLO_MESSAGE' not declared in this scope</code> - она
не объявлена на момент своего вызова.</p><p>Решить эту проблему можно несколькими способами. Во-первых, можно поместить функцию <code>get_hello_message</code>
выше процедуры:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>create</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>or</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>replace</span><span style=color:#bbb> </span>package<span style=color:#bbb> </span>body<span style=color:#bbb> </span>pck_test<span style=color:#bbb> </span><span style=color:#000;font-weight:700>as</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>function</span><span style=color:#bbb> </span>get_hello_message<span style=color:#bbb> </span><span style=color:#000;font-weight:700>return</span><span style=color:#bbb> </span>varchar2<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>is</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>begin</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>return</span><span style=color:#bbb> </span><span style=color:#d14>&#39;Hello, World!&#39;</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>end</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>procedure</span><span style=color:#bbb> </span>print_hello<span style=color:#bbb> </span><span style=color:#000;font-weight:700>is</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>begin</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>dbms_output.put_line(get_hello_message);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>end</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>end</span><span style=color:#bbb> </span>pck_test;<span style=color:#bbb>
</span></span></span></code></pre></div><p>Во-вторых, можно добавить функцию <code>get_hello_message</code> в спецификацию пакета,
и тогда порядок внутри тела не будет ни на что влиять:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>create</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>or</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>replace</span><span style=color:#bbb> </span>package<span style=color:#bbb> </span>pck_test<span style=color:#bbb> </span><span style=color:#000;font-weight:700>as</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>procedure</span><span style=color:#bbb> </span>print_hello;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>function</span><span style=color:#bbb> </span>get_hello_message<span style=color:#bbb> </span><span style=color:#000;font-weight:700>return</span><span style=color:#bbb> </span>varchar2;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>end</span><span style=color:#bbb> </span>pck_test;<span style=color:#bbb>
</span></span></span></code></pre></div><p>Но объявлять всё в спецификации - тоже не выход; Некоторые функции не должны
быть доступны для вызова всеми желающими. В таком случае можно использовать
так называемую <em>Forward declaration</em> - отделить описание функций от их реализации:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>create</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>or</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>replace</span><span style=color:#bbb> </span>package<span style=color:#bbb> </span>body<span style=color:#bbb> </span>pck_test<span style=color:#bbb> </span><span style=color:#000;font-weight:700>as</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#998;font-style:italic>-- Объявляем функцию, но не указываем её реализацию
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#000;font-weight:700>function</span><span style=color:#bbb> </span>get_hello_message<span style=color:#bbb> </span><span style=color:#000;font-weight:700>return</span><span style=color:#bbb> </span>varchar2;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>procedure</span><span style=color:#bbb> </span>print_hello<span style=color:#bbb> </span><span style=color:#000;font-weight:700>is</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>begin</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#998;font-style:italic>-- Ошибки не будет, функция get_hello_message
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#bbb>    </span><span style=color:#998;font-style:italic>-- уже объявлена
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#bbb>    </span>dbms_output.put_line(get_hello_message);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>end</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#998;font-style:italic>-- Реализация функции get_hello_message
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic></span><span style=color:#000;font-weight:700>function</span><span style=color:#bbb> </span>get_hello_message<span style=color:#bbb> </span><span style=color:#000;font-weight:700>return</span><span style=color:#bbb> </span>varchar2<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>is</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>begin</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>return</span><span style=color:#bbb> </span><span style=color:#d14>&#39;Hello, World!&#39;</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>end</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>end</span><span style=color:#bbb> </span>pck_test;<span style=color:#bbb>
</span></span></span></code></pre></div><h3 id=вызов-функций-в-sql-запросах>Вызов функций в SQL запросах</h3><p>Все функции, которые используются в SQL
запросах, должны быть созданы на уровне схемы, то есть
либо быть созданными как отдельные функции(<code>create function</code>),
либо быть объявленными в спецификации пакета. Рассмотрим на примере:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>create</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>or</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>replace</span><span style=color:#bbb> </span>package<span style=color:#bbb> </span>pck_test<span style=color:#bbb> </span><span style=color:#000;font-weight:700>as</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>procedure</span><span style=color:#bbb> </span>print_hello;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>end</span><span style=color:#bbb> </span>pck_test;<span style=color:#bbb>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>create</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>or</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>replace</span><span style=color:#bbb> </span>package<span style=color:#bbb> </span>body<span style=color:#bbb> </span>pck_test<span style=color:#bbb> </span><span style=color:#000;font-weight:700>as</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>function</span><span style=color:#bbb> </span>get_hello_message<span style=color:#bbb> </span><span style=color:#000;font-weight:700>return</span><span style=color:#bbb> </span>varchar2<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>is</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>begin</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>return</span><span style=color:#bbb> </span><span style=color:#d14>&#39;Hello, World!&#39;</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>end</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>procedure</span><span style=color:#bbb> </span>print_hello<span style=color:#bbb> </span><span style=color:#000;font-weight:700>is</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>l_msg<span style=color:#bbb> </span>varchar2(<span style=color:#099>50</span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>begin</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>select</span><span style=color:#bbb> </span>get_hello_message()<span style=color:#bbb> </span><span style=color:#000;font-weight:700>into</span><span style=color:#bbb> </span>l_msg<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>from</span><span style=color:#bbb> </span>dual;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>dbms_output.put_line(l_msg);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>end</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>end</span><span style=color:#bbb> </span>pck_test;<span style=color:#bbb>
</span></span></span></code></pre></div><p>При компиляции тела пакета мы получим ошибку <code>PLS-00231: function 'GET_HELLO_MESSAGE' may not be used in SQL</code>.
Это потому, что мы вызываем функцию из SQL, но данная функция не объявлена в спецификации пакета. Если
мы добавим её сигнатуру в спецификацию, то все будет работать:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>create</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>or</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>replace</span><span style=color:#bbb> </span>package<span style=color:#bbb> </span>pck_test<span style=color:#bbb> </span><span style=color:#000;font-weight:700>as</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>procedure</span><span style=color:#bbb> </span>print_hello;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>function</span><span style=color:#bbb> </span>get_hello_message<span style=color:#bbb> </span><span style=color:#000;font-weight:700>return</span><span style=color:#bbb> </span>varchar2;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>end</span><span style=color:#bbb> </span>pck_test;<span style=color:#bbb>
</span></span></span></code></pre></div><pre tabindex=0><code>begin
    -- Выведет &#34;Hello, World!&#34;
    pck_test.print_hello;
end;
</code></pre><nav class="pagination mb-3"><ul class=pagination-list><li class=pagination-item><a href=http://orasql.ru/plsql/basics/context/ class="pagination-link pagination-prev">&lt; Взаимодействие PL/SQL и SQL. Переключение контекста</a></li><li class="pagination-item ml-auto"><a href=http://orasql.ru/plsql/basics/loops/ class="pagination-link pagination-next">Циклы в PL/SQL ></a></li></ul></nav></div><footer class="footer b-dark-low b-top"><div class="footer-container container centered edges"><div class="footer-body mt-10"><nav class="nav nav-muted nav-menu-sm"><ul class=nav-list><li class=nav-item><a href=/ class=nav-link>Orasql.ru</a></li><li class=nav-item><a href=/ class=nav-link>Учебник</a></li><li class=nav-item><p class="text-medium text-moderated">Email: orasqlru@gmail.com</p></li></ul></nav></div><div class="footer-copy mt-6 pt-6 b-dark-7 b-top"><p class="text-medium text-moderated">© Orasql.ru<br>2019-2021</p></div></div></footer></body></html>