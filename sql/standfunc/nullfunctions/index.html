<!doctype html><html><head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<link rel=stylesheet href=/css/superkube.min.css>
<link rel=stylesheet href=/css/main.css>
<script>var clicky_site_ids=clicky_site_ids||[];clicky_site_ids.push(101305633)</script>
<script async src=//static.getclicky.com/js></script>
<title>Учебник Oracle SQL, PL/SQL | Функции для работы с NULL</title>
</head>
<body><div class="navbar bg-dark mb-10">
<div class="navbar-container container edges centered">
<div class=navbar-brand>
<a href=/ class=brand>
Orasql.ru
</a>
</div>
<div class="navbar-nav ml-6">
<nav class="nav nav-light nav-semibold">
<ul class=nav-list>
<li class=nav-item><a href=/book/ class=nav-link>Книга</a></li>
</ul>
</nav>
<nav class="nav nav-light nav-semibold">
<ul class=nav-list>
<li class=nav-item><a href=https://github.com/cyevgeniy/orasqlru class=nav-link>Github</a></li>
</ul>
</nav>
</div>
</div>
</div>
<div id=container class="container-medium edges centered">
<div class="doc-head mb-4 container-10">
<h5 class="heading-micro heading-muted">Стандарные функции</h5>
<h1 class="heading-huge heading-heavy">Функции для работы с NULL</h1>
</div>
<div class="doc-toc mt-6 mb-6">
<nav class="menu menu-underline menu-medium menu-numbered">
<ul class=menu-list>
<li class=menu-item>
<a href=#%d0%bf%d0%be%d0%b4%d0%b3%d0%be%d1%82%d0%be%d0%b2%d0%ba%d0%b0-%d1%82%d0%b5%d1%81%d1%82%d0%be%d0%b2%d1%8b%d1%85-%d0%b4%d0%b0%d0%bd%d0%bd%d1%8b%d1%85 class=menu-link>Подготовка тестовых данных</a>
</li><li class=menu-item>
<a href=#nvl class=menu-link>Nvl</a>
</li><li class=menu-item>
<a href=#nvl2 class=menu-link>Nvl2</a>
</li><li class=menu-item>
<a href=#coalesce class=menu-link>Coalesce</a>
</li></ul></nav>
</div>
<p>Так как <code>NULL</code> - особое значение, то он удостоился отдельных функций в
Oracle, которые умеют работать с ним &ldquo;из коробки&rdquo;.</p>
<h2 id=подготовка-тестовых-данных>Подготовка тестовых данных</h2>
<p>Работать будем со следующей таблицей:</p>
<pre><code>create table profiles(
    login varchar2(30) primary key,
    last_updated date,
    status varchar2(50)
);

comment on table profiles is 'Профили форума';
comment on column profiles.last_updated is 'Дата последнего обновления';
comment on column profiles.status is 'Статус';

insert into profiles(login, last_updated, status)
values ('johndoe', to_date('01.01.2009 23:40', 'dd.mm.yyyy hh24:mi'), '');

insert into profiles(login, last_updated, status)
values ('admin', to_date('01.01.2019 21:03', 'dd.mm.yyyy hh24:mi'), 'Я админ. Все вопросы ко мне');

insert into profiles(login, last_updated, status)
values ('alisa', null, 'Окажу помощь в проектировании домов');

insert into profiles(login, last_updated, status)
values ('nelsol', null, null);
</code></pre>
<h2 id=nvl>Nvl</h2>
<pre><code>select nvl(2, 10) nvl_1,
    nvl(null, 20) nvl_2
from dual
</code></pre>
<p>Данная функция принимает 2 параметра. Если первый параметр равен <code>NULL</code>,
то будет возвращен второй параметр. В противном случае функция вернет
первый параметр.</p>
<pre><code>select pf.login,
    pf.last_updated,
    nvl(pf.status, '') status
from profiles pf
</code></pre>
<p><img src=/img/4_1_nulls/nvl.png alt></p>
<p>Здесь мы получаем данные из таблицы профилей, и в том случае, если
статус пуст, выводим строку &ldquo;&rdquo;.</p>
<h2 id=nvl2>Nvl2</h2>
<p>Функция <code>nvl2</code> работает немного сложнее. Она принимает 3 параметра. В
том случае, если первый параметр не <code>NULL</code>, она вернет второй параметр.
В противном случае она вернет третий параметр:</p>
<pre><code>select pf.login,
    pf.last_updated,
    nvl2(pf.status, 'статус указан', 'статус не указан') status
from profiles pf
</code></pre>
<p><img src=/img/4_1_nulls/nvl2.png alt></p>
<h2 id=coalesce>Coalesce</h2>
<p>Данная функция принимает на вход любое количество параметров и
возвращает первое, из них, которое не является <code>NULL</code>:</p>
<pre><code>select login,
       coalesce(status, 'статус пуст') first_not_null,
       coalesce(status, null, null, 'статус пуст') first_not_null_1,
       coalesce('статус всегда заполнен', status) first_not_null_2
from profiles
</code></pre>
<p><img src=/img/4_1_nulls/coalesce.png alt></p>
<p>В том случае, если в функцию <code>COALESCE</code> передаются параметры разных
типов, то все параметры будут приведены к типу первого <code>NOT NULL</code>
аргумента.</p>
<p>В том случае, если этого сделать не получится, будет выброшена ошибка:</p>
<pre><code>select coalesce(null, 'String', 'String_2') not_null_str
from dual
</code></pre>
<p><img src=/img/4_1_nulls/coalesce_1.png alt></p>
<pre><code>select coalesce(null, 'String', 23.4) not_null_str
from dual
</code></pre>
<p><img src=/img/4_1_nulls/coalesce_error.png alt></p>
<p>При этом, если число привести к строке самим, все будет работать, как
ожидается:</p>
<pre><code>select coalesce(null, 'String', to_char(23.4)) not_null_str
from dual
</code></pre>
<p><img src=/img/4_1_nulls/coalesce_1.png alt></p>
<nav class="pagination mb-3">
<ul class=pagination-list>
<li class=pagination-item>
<a href=http://orasql.ru/sql/standfunc/stringfunctions/ class="pagination-link pagination-prev"> &lt; Функции для работы со строками </a>
</li>
<li class="pagination-item ml-auto">
<a href=http://orasql.ru/sql/standfunc/conditional/ class="pagination-link pagination-next"> Условные функции > </a>
</li>
</ul>
</nav>
</div>
<footer class="footer b-dark-low b-top">
<div class="footer-container container centered edges">
<div class="footer-body mt-10">
<nav class="nav nav-muted nav-menu-sm"><ul class=nav-list>
<li class=nav-item><a href=/ class=nav-link>Orasql.ru</a></li>
<li class=nav-item><a href=/ class=nav-link>Учебник</a></li>
<li class=nav-item><p class="text-medium text-moderated">Email: orasqlru@gmail.com</p></li>
</ul>
</nav>
</div>
<div class="footer-copy mt-6 pt-6 b-dark-7 b-top">
<p class="text-medium text-moderated">© Orasql.ru <br> 2019-2021</p>
</div>
</div>
</footer>
</body>
</html>