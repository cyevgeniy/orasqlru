<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=/css/design.css><link rel=stylesheet href=/css/layout.css><link rel=stylesheet href=/css/base.css><link rel=stylesheet href=/css/navigation.css><script async src="https://www.googletagmanager.com/gtag/js?id=UA-144211477-1"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-144211477-1")</script><title>Учебник Oracle SQL, PL/SQL | Exists. Наличие строк в подзапросе</title></head><body><div class=menu><a href=/ class=menu__item>Orasql.ru</a>
<a href=/#sql class=menu__item>Учебник Oracle SQL</a>
<a href=/#plsql class=menu__item>Учебник PL/SQL</a></div><div class=content><h1>Exists. Наличие строк в подзапросе</h1><p>Оператор <code>EXISTS</code> имеет вид <code>EXISTS(подзапрос)</code>, и возвращает истинное значение
в том случае, если подзапрос в скобках возвращает хотя
бы одну строку. Может использоваться с оператором <code>NOT</code>.</p><p>Примеры будем разбирать на данных из части про <a href=/sql/basics/subqueries/>подзапросы</a>.</p><p><strong>Пример №1:</strong> Получить список книг, которые заказывались хотя бы раз.</p><p>Очевидно что ответом будут те книги, ссылки на которые есть в
таблице <code>book_orders</code>. Нас устроит любая книга, которая имеет
хотя бы один заказ, и поэтому задача легко решается с использованием <code>EXISTS</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>select</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>*</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>from</span><span style=color:#bbb> </span>books<span style=color:#bbb> </span>b<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>where</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>exists</span>(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>select</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>null</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>from</span><span style=color:#bbb> </span>book_orders<span style=color:#bbb> </span>bo<span style=color:#bbb> </span><span style=color:#000;font-weight:700>where</span><span style=color:#bbb> </span>bo.book_id<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span>b.book_id<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>)<span style=color:#bbb>
</span></span></span></code></pre></div><table><thead><tr><th>BOOK_ID</th><th>BOOK_NAME</th><th>AUTHOR</th><th>RELEASE_YEAR</th></tr></thead><tbody><tr><td>1</td><td>Властелин колец</td><td>Толкин</td><td>1954</td></tr><tr><td>2</td><td>Гордость и предубеждение</td><td>Джейн Остин</td><td>1813</td></tr><tr><td>3</td><td>Тёмные начала</td><td>Филип Пулман</td><td>1995</td></tr></tbody></table><p>Здесь использовался коррелированный подзапрос, который проверяет
наличие данных в таблице с заказами. Подзапрос может быть любым,
и он не обязан быть коррелированным. Все, что проверяет
<code>EXISTS</code> — это то, вернул ли подзапрос какие-либо данные, или нет.</p><p>Следует обратить внимание на то, что мы не указываем наименования
колонок в подзапросе, так как сами данные нам не интересны — нас
интересует лишь факт наличия данных, которые возвращает подзапрос.</p><p>Следующий запрос идентичен предыдущему:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>select</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>*</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>from</span><span style=color:#bbb> </span>books<span style=color:#bbb> </span>b<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>where</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>exists</span>(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>select</span><span style=color:#bbb> </span>bo.book_id,<span style=color:#bbb> </span>bo.quantity<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>from</span><span style=color:#bbb> </span>book_orders<span style=color:#bbb> </span>bo<span style=color:#bbb> </span><span style=color:#000;font-weight:700>where</span><span style=color:#bbb> </span>bo.book_id<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span>b.book_id<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>)<span style=color:#bbb>
</span></span></span></code></pre></div><p>Только здесь нет смысла в получении колонок
<code>book_id</code> и <code>quantity</code>, так как они никак не будут использованы.</p><p><strong>Пример №2</strong>: Получить список книг, которые ни разу не покупали.</p><p>Решение здесь прямо обратное предыдущему — нас интересуют такие книги, на которы из таблицы с заказами нет ссылок:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#000;font-weight:700>select</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>*</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>from</span><span style=color:#bbb> </span>books<span style=color:#bbb> </span>b<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#000;font-weight:700>where</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>not</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>exists</span>(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>select</span><span style=color:#bbb> </span><span style=color:#000;font-weight:700>null</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#000;font-weight:700>from</span><span style=color:#bbb> </span>book_orders<span style=color:#bbb> </span>bo<span style=color:#bbb> </span><span style=color:#000;font-weight:700>where</span><span style=color:#bbb> </span>bo.book_id<span style=color:#bbb> </span><span style=color:#000;font-weight:700>=</span><span style=color:#bbb> </span>b.book_id<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>)<span style=color:#bbb>
</span></span></span></code></pre></div><table><thead><tr><th>BOOK_ID</th><th>BOOK_NAME</th><th>AUTHOR</th><th>RELEASE_YEAR</th></tr></thead><tbody><tr><td>4</td><td>Автостопом по галактике</td><td>Дуглас Адамс</td><td>1979</td></tr></tbody></table></div><footer class="footer b-dark-low b-top"><div class="footer-container container centered edges"><p class="text-medium text-moderated">© Orasql.ru<br>2019-2023</p></div></div></footer></body></html>