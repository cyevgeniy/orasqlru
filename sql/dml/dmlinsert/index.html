<!doctype html><html><head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<link rel=stylesheet href=/css/superkube.min.css>
<link rel=stylesheet href=/css/main.css>
<title>Учебник Oracle SQL, PL/SQL | Оператор INSERT</title>
</head>
<body><div class="navbar bg-dark mb-10">
<div class="navbar-container container edges centered">
<div class=navbar-brand>
<a href=/ class=brand>
Orasql.ru
</a>
</div>
<div class="navbar-nav ml-6">
<nav class="nav nav-light nav-semibold">
<ul class=nav-list>
<li class=nav-item><a href=/book/ class=nav-link>Книга</a></li>
</ul>
</nav>
<nav class="nav nav-light nav-semibold">
<ul class=nav-list>
<li class=nav-item><a href=https://github.com/cyevgeniy/orasqlru class=nav-link>Github</a></li>
</ul>
</nav>
</div>
</div>
</div>
<div id=container class="container-medium edges centered">
<div class="doc-head mb-4 container-10">
<h5 class="heading-micro heading-muted">DML. Изменение данных и структуры БД</h5>
<h1 class="heading-huge heading-heavy">Оператор INSERT</h1>
</div>
<div class="doc-toc mt-6 mb-6">
<nav class="menu menu-underline menu-medium menu-numbered">
<ul class=menu-list>
<li class=menu-item>
<a href=#%d0%b2%d1%81%d1%82%d0%b0%d0%b2%d0%ba%d0%b0-%d1%81-%d1%83%d0%ba%d0%b0%d0%b7%d0%b0%d0%bd%d0%b8%d0%b5%d0%bc-%d0%ba%d0%be%d0%bb%d0%be%d0%bd%d0%be%d0%ba class=menu-link>Вставка с указанием колонок</a>
</li><li class=menu-item>
<a href=#%d0%b2%d1%81%d1%82%d0%b0%d0%b2%d0%ba%d0%b0-%d0%b1%d0%b5%d0%b7-%d1%83%d0%ba%d0%b0%d0%b7%d0%b0%d0%bd%d0%b8%d1%8f-%d0%ba%d0%be%d0%bb%d0%be%d0%bd%d0%be%d0%ba class=menu-link>Вставка без указания колонок</a>
</li><li class=menu-item>
<a href=#insert-into--select class=menu-link>INSERT INTO &mldr; SELECT</a>
</li></ul></nav>
</div>
<p>Как уже говорилось ранее, <code>INSERT</code> предназначен для вставки данных в
таблицу. Существует несколько вариантов его использования.</p>
<h2 id=вставка-с-указанием-колонок>Вставка с указанием колонок</h2>
<p>В таком варианте после указания таблицы в скобках перечисляются колонки,
в которые будут записываться указываемые данные.</p>
<pre><code>insert into employees(id, name, age)
values(1, 'John', 35)
</code></pre>
<p>Данный способ является предпочтительным, т.к. он более информативен -
сразу видно, что за данные вставляются в таблицу.</p>
<p>Также, при использовании такого способа, можно изменять порядок
перечисления данных для строки:</p>
<pre><code>insert into employees(age, name, id)
values(30, 'Dave', 2)
</code></pre>
<h2 id=вставка-без-указания-колонок>Вставка без указания колонок</h2>
<p>При таком варианте список столбцов таблицы не перечисляется, а сразу
указываются значения, которые вставляются в таблицу:</p>
<pre><code>insert into employees
values(1, 'John', 35)
</code></pre>
<p>Такой способ подразумевает, что мы будем перечислять значения для всех
колонок в таблице, причем в том порядке, в котором они следуют в
таблице.</p>
<p>Такой способ лучше не использовать, т.к. он:</p>
<ul>
<li>Неинформативен. Невозможно сказать, что значит 1, а что 35 без
просмотра структуры таблицы</li>
<li>Нестабилен к изменениям. Добавление/удаление колонки из таблицы
потребует добавления/удаления значения из запроса.</li>
</ul>
<p>Разберем последний минус данного подхода. Предположим, что в таблице
<code>employees</code> колонка <code>age</code> необязательна, т.е. может содержать <code>NULL</code>.</p>
<p>В случае, когда мы указываем колонки, мы можем сделать так:</p>
<pre><code>insert into employees(id, name)
values(1, 'John')
</code></pre>
<p>Если использовать вариант без указания колонок, то мы будем вынуждены
прописывать значения для всех колонок:</p>
<pre><code>insert into employees(id, name, age)
values(1, 'John', null)
</code></pre>
<p>Попытка указать всего 2 значения при вставке приведет к ошибке
<code>ORA-00947: not enough values</code>:</p>
<pre><code>-- выдаст ошибку ORA-00947: not enough values
insert into employees
values(1, 'John')
</code></pre>
<p>То же самое будет и в случае, если мы добавим в таблицу необязательную
колонку - написанный ранее запрос с перечислением колонок будет
работать, а запрос, в котором колонки не указывались - нет.</p>
<h2 id=insert-into--select>INSERT INTO &mldr; SELECT</h2>
<p>Данный способ очень мощная и гибкая возможность. Она позволяет
использовать значения, возвращаемые оператором <code>select</code> в качестве
значений для вставки.</p>
<p>В общем виде подобный запрос выглядит так:</p>
<pre><code>insert into table_1(column_1, column_2, column_3...)
select col_1,
       col_2,
       col_3,
       ....
from table_2
</code></pre>
<p>Более конкретный пример может выглядеть так: предположим, что нас
попросили записать в таблицу <code>emp_report</code> список сотрудников, которые
старше 40 лет. Из этой таблицы потом экспортируют данные в отчет для
руководства.</p>
<pre><code>insert into emp_report(emp_id, name)
select emp.id,
       emp.name
from employees emp
where emp.age &gt; 40
</code></pre>
<p>В случае, если запрос <code>select</code> не вернул никаких данных, то в таблицу
также не будет вставлено ни одной строки.</p>
<p>В следующем примере данные не будут добавлены в таблицу(предполагается,
что в таблице <code>employees</code> нет сотрудников с отрицательным возрастом):</p>
<pre><code>insert into emp_report(emp_id, name)
select emp.id,
       emp.name
from employees emp
where emp.age &lt; 0
</code></pre>
<p>Запрос, получающий данные, может быть достаточно сложным - в нем могут
использоваться соединения таблиц, различные условия, подзапросы и т.п.</p>
<p>Предположим, нас попросили добавить также и количество детей у
сотрудника. Список детей по сотрудникам хранится в таблице <code>emp_childs</code>.
Тогда запрос вставки данных мог выглядеть следующим образом:</p>
<pre><code>insert into emp_report(emp_id, name, childs_count)
select emp.id,
       emp.name,
       count(chlds.id) childs_count
from employees emp
join emp_childs chlds on chlds.emp_id = emp.id
where emp.age &gt; 40
group by emp.id, emp.name
</code></pre>
<nav class="pagination mb-3">
<ul class=pagination-list>
<li class="pagination-item ml-auto">
<a href=https://orasql.ru/sql/dml/dmlupdate/ class="pagination-link pagination-next"> Изменение данных. UPDATE > </a>
</li>
</ul>
</nav>
</div>
<footer class="footer b-dark-low b-top">
<div class="footer-container container centered edges">
<div class="footer-body mt-10">
<nav class="nav nav-muted nav-menu-sm"><ul class=nav-list>
<li class=nav-item><a href=/ class=nav-link>Orasql.ru</a></li>
<li class=nav-item><a href=/ class=nav-link>Учебник</a></li>
<li class=nav-item><p class="text-medium text-moderated">Email: orasqlru@gmail.com</p></li>
</ul>
</nav>
</div>
<div class="footer-copy mt-6 pt-6 b-dark-7 b-top">
<p class="text-medium text-moderated">© Orasql.ru <br> 2019-2021</p>
</div>
</div>
</footer>
</body>
</html>