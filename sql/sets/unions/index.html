<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=/css/design.css><link rel=stylesheet href=/css/layout.css><link rel=stylesheet href=/css/base.css><link rel=stylesheet href=/css/navigation.css><script async src="https://www.googletagmanager.com/gtag/js?id=UA-144211477-1"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-144211477-1")</script><title>Учебник Oracle SQL, PL/SQL | Объединение. UNION</title></head><body><div class=menu><a href=/ class=menu__item>Orasql.ru</a>
<a href=/#sql class=menu__item>Учебник Oracle SQL</a>
<a href=/#plsql class=menu__item>Учебник PL/SQL</a></div><div class=content><h1>Объединение. UNION</h1><p>Предположим, что у нас есть 2 таблицы - таблица учителей <code>teachers</code> и
таблица учеников <code>students</code>:</p><pre><code>create table teachers(
    id number primary key,
    first_name varchar2(50) not null,
    last_name varchar2(100)
);

create table students(
    id number primary key,
    first_name varchar2(50) not null,
    last_name varchar2(100),
    group_id number
);

    insert into teachers values (1, 'Галина', 'Иванова');
    insert into teachers values (2, 'Нина', 'Сидорова');
    insert into teachers values (3, 'Евгения', 'Петрова');

    insert into students values (1, 'Александр', 'Обломов', 1);
    insert into students values (2, 'Николай', 'Рудин', 2);
    insert into students values (3, 'Евгения', 'Петрова', 1);
</code></pre><p>Перед нами стоит задача - нужно отобразить единым списком учителей и
учеников.</p><p>Мы можем написать запрос для получения списка учителей:</p><pre><code>select first_name, last_name
from teachers
</code></pre><p>Точно также можно получить список всех учеников:</p><pre><code>select first_name, last_name
from students
</code></pre><p>Для того, чтобы эти данные &ldquo;склеить&rdquo;, используется оператор <code>UNION</code>:</p><pre><code>select first_name, last_name
from teachers

union

select first_name, last_name
from students
</code></pre><p><img src=/img/7_unions/union_example.png alt></p><p>Если внимательно посмотреть на получившийся результат, то можно
заметить, что данных в &ldquo;склеенной&rdquo; выборке стало меньше.</p><p>Все дело в том, то оператор UNION удаляет дубликаты из итоговой выборки.
А так как у нас есть учитель &ldquo;Евгения Петрова&rdquo; и ученик &ldquo;Евгения
Петрова&rdquo;, то при объединении оставляется только одна строка.</p><p>Для того, чтобы объединить данные из нескольких запросов без удаления
дубликатов, используется оператор <code>UNION ALL</code>:</p><pre><code>select first_name, last_name
from teachers

union all

select first_name, last_name
from students
</code></pre><p>Если вы знаете, что в объединяемых данных не будет повторяющихся строк,
используйте <code>UNION ALL</code>. В таком случае БД не будет тратить время на то,
чтобы убрать дубликаты из итоговой выборки.</p><p>Для того, чтобы <code>UNION</code> работал, должны соблюдаться некоторые условия:</p><ul><li>Количество полей в каждой выборке должно быть одинаковым</li><li>Поля должны иметь одинаковый тип</li></ul><p>То есть, следующий запрос вернет ошибку, т.к. в первой части объединения
запрос возвращает число первой колонкой, а второй - строку:</p><pre><code>select id, first_name
from teachers

union

select first_name, last_name
from students
</code></pre><p>Результат - ошибка
<code>ORA-01790: expression must have same datatype as corresponding expression</code>.</p><p>Кстати, псевдонимы столбцов не обязательно должны совпадать у всех
частей соединения:</p><pre><code>select first_name teacher_first_name, last_name teacher_last_name
from teachers

union

select first_name, last_name
from students
</code></pre><p><img src=/img/7_unions/union_aliases.png alt></p><p>Следует обратить внимание на то, что в результирующей выборке псевдонимы
для колонок взялись такие же, как и в запросе из первой части
объединения. Если поменять эти части местами, то псевдонимы также
изменятся:</p><pre><code>select first_name, last_name
from students

union

select first_name teacher_first_name, last_name teacher_last_name
from teachers
</code></pre><p><img src=/img/7_unions/union_aliases_1.png alt></p></div><footer class="footer b-dark-low b-top"><div class="footer-container container centered edges"><p class="text-medium text-moderated">© Orasql.ru<br>2019-2023</p></div></div></footer></body></html>