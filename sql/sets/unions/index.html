<!doctype html><html><head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<link rel=stylesheet href=/css/superkube.min.css>
<link rel=stylesheet href=/css/main.css>
<title>Учебник Oracle SQL, PL/SQL | Объединение. UNION</title>
</head>
<body><div class="navbar bg-dark mb-10">
<div class="navbar-container container edges centered">
<div class=navbar-brand>
<a href=/ class=brand>
Orasql.ru
</a>
</div>
<div class="navbar-nav ml-6">
<nav class="nav nav-light nav-semibold">
<ul class=nav-list>
<li class=nav-item><a href=/orasqlru/book/ class=nav-link>Книга</a></li>
</ul>
</nav>
<nav class="nav nav-light nav-semibold">
<ul class=nav-list>
<li class=nav-item><a href=https://github.com/cyevgeniy/orasqlru class=nav-link>Github</a></li>
</ul>
</nav>
</div>
</div>
</div>
<div id=container class="container-medium edges centered">
<div class="doc-head mb-4 container-10">
<h5 class="heading-micro heading-muted">Работа с множествами</h5>
<h1 class="heading-huge heading-heavy">Объединение. UNION</h1>
</div>
<p>Предположим, что у нас есть 2 таблицы - таблица учителей <code>teachers</code> и
таблица учеников <code>students</code>:</p>
<pre><code>create table teachers(
    id number primary key,
    first_name varchar2(50) not null,
    last_name varchar2(100)
);

create table students(
    id number primary key,
    first_name varchar2(50) not null,
    last_name varchar2(100),
    group_id number
);

    insert into teachers values (1, 'Галина', 'Иванова');
    insert into teachers values (2, 'Нина', 'Сидорова');
    insert into teachers values (3, 'Евгения', 'Петрова');

    insert into students values (1, 'Александр', 'Обломов', 1);
    insert into students values (2, 'Николай', 'Рудин', 2);
    insert into students values (3, 'Евгения', 'Петрова', 1);
</code></pre>
<p>Перед нами стоит задача - нужно отобразить единым списком учителей и
учеников.</p>
<p>Мы можем написать запрос для получения списка учителей:</p>
<pre><code>select first_name, last_name
from teachers
</code></pre>
<p>Точно также можно получить список всех учеников:</p>
<pre><code>select first_name, last_name
from students
</code></pre>
<p>Для того, чтобы эти данные &ldquo;склеить&rdquo;, используется оператор <code>UNION</code>:</p>
<pre><code>select first_name, last_name
from teachers

union

select first_name, last_name
from students
</code></pre>
<p><img src=/img/7_unions/union_example.png alt></p>
<p>Если внимательно посмотреть на получившийся результат, то можно
заметить, что данных в &ldquo;склеенной&rdquo; выборке стало меньше.</p>
<p>Все дело в том, то оператор UNION удаляет дубликаты из итоговой выборки.
А так как у нас есть учитель &ldquo;Евгения Петрова&rdquo; и ученик &ldquo;Евгения
Петрова&rdquo;, то при объединении оставляется только одна строка.</p>
<p>Для того, чтобы объединить данные из нескольких запросов без удаления
дубликатов, используется оператор <code>UNION ALL</code>:</p>
<pre><code>select first_name, last_name
from teachers

union all

select first_name, last_name
from students
</code></pre>
<p>Если вы знаете, что в объединяемых данных не будет повторяющихся строк,
используйте <code>UNION ALL</code>. В таком случае БД не будет тратить время на то,
чтобы убрать дубликаты из итоговой выборки.</p>
<p>Для того, чтобы <code>UNION</code> работал, должны соблюдаться некоторые условия:</p>
<ul>
<li>Количество полей в каждой выборке должно быть одинаковым</li>
<li>Поля должны иметь одинаковый тип</li>
</ul>
<p>То есть, следующий запрос вернет ошибку, т.к. в первой части объединения
запрос возвращает число первой колонкой, а второй - строку:</p>
<pre><code>select id, first_name
from teachers

union

select first_name, last_name
from students
</code></pre>
<p>Результат - ошибка
<code>ORA-01790: expression must have same datatype as corresponding expression</code>.</p>
<p>Кстати, псевдонимы столбцов не обязательно должны совпадать у всех
частей соединения:</p>
<pre><code>select first_name teacher_first_name, last_name teacher_last_name
from teachers

union

select first_name, last_name
from students
</code></pre>
<p><img src=/img/7_unions/union_aliases.png alt></p>
<p>Следует обратить внимание на то, что в результирующей выборке псевдонимы
для колонок взялись такие же, как и в запросе из первой части
объединения. Если поменять эти части местами, то псевдонимы также
изменятся:</p>
<pre><code>select first_name, last_name
from students

union

select first_name teacher_first_name, last_name teacher_last_name
from teachers
</code></pre>
<p><img src=/img/7_unions/union_aliases_1.png alt></p>
<nav class="pagination mb-3">
<ul class=pagination-list>
<li class="pagination-item ml-auto">
<a href=https://cyevgeniy.github.io/orasqlru/sql/sets/minus/ class="pagination-link pagination-next"> Разница запросов. MINUS > </a>
</li>
</ul>
</nav>
</div>
<footer class="footer b-dark-low b-top">
<div class="footer-container container centered edges">
<div class="footer-body mt-10">
<nav class="nav nav-muted nav-menu-sm"><ul class=nav-list>
<li class=nav-item><a href=/ class=nav-link>Orasql.ru</a></li>
<li class=nav-item><a href=/ class=nav-link>Учебник</a></li>
<li class=nav-item><p class="text-medium text-moderated">Email: orasqlru@gmail.com</p></li>
</ul>
</nav>
</div>
<div class="footer-copy mt-6 pt-6 b-dark-7 b-top">
<p class="text-medium text-moderated">© Orasql.ru <br> 2019-2021</p>
</div>
</div>
</footer>
</body>
</html>