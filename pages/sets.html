<!--{
    "Title": "Работа с множествами. Общая информация",
    "Links": {
        "Next": {
            "Url": "../stringfunctions/index.html",
            "Title": "Функции для работы со строками"
        },
        "Prev": {
            "Url": "../intersect/index.html",
            "Title": "Пересечение. INTERSECT"
        }
        }
}-->

<div class="doc-head mb-4 container-10">
    <h5 class="heading-micro heading-muted">Работа с множествами</h5>
    <h1 class="heading-huge heading-heavy">Работа с множествами. Общая информация</h1>
</div>

<div class="doc-toc mt-6 mb-6">
    <nav class="menu menu-underline menu-medium menu-numbered">
        <ul class="menu-list">
        <li class="menu-item"><a href="#columnsorder" class="menu-link">Следить за порядком колонок</a></li>
        <li class="menu-item"><a href="#orderby" class="menu-link">Сортировка</a></li>
        <li class="menu-item"><a href="#priority" class="menu-link">Приоритет выполнения</a></li>
        </ul>
    </nav>
</div>

<h2 id="columnsorder">Следить за порядком колонок</h2>

<p>
При использовании операторов UNION, MINUS и INTERSECT
нужно внимательно следить за порядком колонок
в каждом из запросов, ведь несоблюдение порядка следования
приведет к некорректным результатам.
</p>

<p>
Как было рассмотрено, Oracle будет проверять, чтобы
тип колонок в каждом из запросов совпадал, но проверять,
правильно ли расположены колонки одного типа, он не будет
(потому что не сможет).
</p>


<pre>
select car_model model, car_id release_year
from cars

minus

select car_model, release_year
from car_offers
</pre>

<img src="../../img/7_unions/col_order_with_error.png">

<p>
В запросе выше, в первой его части, вместо колонки <code>release_year</code>
по ошибке была указана колонка <code>car_id</code>. Так как обе имеют числовой
тип, ошибки не было, но данные на выходе получились ошибочными.
</p>

<p>
Следует внимательно следить за порядком колонок
в каждом из запросов при использовании операторов
для работы с множествами.
</p>


<h2 id="orderby">Сортировка</h2>

<p>
<code>ORDER BY</code> добавляется в конце запроса, и применяется
к уже получившемуся в результате выполнения оператора множества
набору данных.
</p>

<p>
Следующий пример получит список авто из имеющихся у нас, но
отсутствующих в списке предлагаемых моделей, и отсортирует итоговую
выборку по возрастанию года выпуска:
</p>

<pre>
select car_model, release_year
from cars


minus

select car_model, release_year a2
from car_offers
order by release_year
</pre>

<pre>
Использовать сортировку в первом запросе нельзя, получим ошибку
<code>ORA-00933: SQL command not properly ended</code>:
</pre>

<pre>
-- Ошибка!
select car_model, release_year
from cars
order by release_year

minus

select car_model, release_year
from car_offers
</pre>

<p>
Как и в случае с обычными запросами, сортировать
можно по порядковому номеру колонки итоговой выборки:
</p>

<pre>
select car_model, release_year
from cars

minus

select car_model, release_year a2
from car_offers
-- Сортировка по модели авто
order by 1 desc
</pre>

<h2 id="priority">Приоритет выполнения</h2>

<p>
Между собой операторы множества имеют
одинаковый приоритет. Если в запросе
используется несколько таких операторов,
то они выполняются последовательно.
</p>

<pre>
select car_model, release_year
from cars

minus

select car_model, release_year
from car_offers

union all

select car_model, release_year
from cars
</pre>


<img src="../../img/_unions/sets_priority_1.png">

<p>
В данном примере сначала был выполнен
оператор <code>MINUS</code>, и уже после
к полученному результату был применен
оператор <code>UNION ALL</code>.
</p>

<p>
Чтобы изменить порядок выполнения операторов,
используются скобки:
</p>

<pre>
select car_model, release_year
from cars

minus

-- minus будет применен
-- к результату выполнения
-- UNION ALL
(select car_model, release_year
from car_offers

UNION ALL

select car_model, release_year
from cars)
</pre>

<p>
Здесь оператор <code>MINUS</code> будет применяться
к набору данных, который получится
в результате выполнения <code>UNION ALL</code>.
</p>



