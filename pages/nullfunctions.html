<!--{
    "Title": "Функции для работы с NULL",
    "Links": {
        "Next": {
            "Url": "../conditional/index.html",
            "Title": "Условные функции"
        },
        "Prev": {
            "Url": "../stringfunctions/index.html",
            "Title": "Функции для работы со строками"
        }
        }
}-->

<div class="doc-head mb-4 container-10">
    <h5 class="heading-micro heading-muted">Стандарные функции</h5>
    <h1 class="heading-huge heading-heavy">Функции для работы с NULL</h1>
</div>

<div class="doc-toc mt-6 mb-6">
    <nav class="menu menu-underline menu-medium menu-numbered">
        <ul class="menu-list">
        <li class="menu-item"><a href="#prepare" class="menu-link">Подготовка тестовых данных</a></li>
        <li class="menu-item"><a href="#nvl" class="menu-link"><code>NVL</code></a></li>
        <li class="menu-item"><a href="#nvl2" class="menu-link"><code>NVL2</code></a></li>
        <li class="menu-item"><a href="#coalesce" class="menu-link"><code>COALESCE</code></a></li>
        </ul>
    </nav>
</div>


<p>
Так как <code>NULL</code> - особое значение, то он удостоился
отдельных функций в Oracle, которые умеют работать с ним "из коробки".
</p>

<h2 id="prepare">Подготовка тестовых данных </h2>

<p>
Работать будем со следующей таблицей:
</p>

<pre>
create table profiles(
    login varchar2(30) primary key,
    last_updated date,
    status varchar2(50)
);

comment on table profiles is 'Профили форума';
comment on column profiles.last_updated is 'Дата последнего обновления';
comment on column profiles.status is 'Статус';

insert into profiles(login, last_updated, status)
values ('johndoe', to_date('01.01.2009 23:40', 'dd.mm.yyyy hh24:mi'), '');

insert into profiles(login, last_updated, status)
values ('admin', to_date('01.01.2019 21:03', 'dd.mm.yyyy hh24:mi'), 'Я админ. Все вопросы ко мне');

insert into profiles(login, last_updated, status)
values ('alisa', null, 'Окажу помощь в проектировании домов');

insert into profiles(login, last_updated, status)
values ('nelsol', null, null);
</pre>

<h2 id="nvl">Nvl</h2>

<pre>
select nvl(2, 10) nvl_1,
    nvl(null, 20) nvl_2
from dual
</pre>


<p>
Данная функция принимает 2 параметра. Если первый
параметр равен <code>NULL</code>, то будет возвращен второй параметр.
В противном случае функция вернет первый параметр.
</p>

<pre>
select pf.login,
    pf.last_updated,
    nvl(pf.status, '<нет данных>') status
from profiles pf
</pre>


<img src="../../img/4_1_nulls/nvl.png">

<p>
Здесь мы получаем данные из таблицы профилей, и в том случае,
если статус пуст, выводим строку "<нет данных>".
</p>

<h2 id="nvl2">Nvl2</h2>

<p>
Функция <code>nvl2</code> работает немного сложнее.
Она принимает 3 параметра. В том случае, если первый
параметр не <code>NULL</code>, она вернет второй параметр.
В противном случае она вернет третий параметр:
</p>

<pre>
select pf.login,
    pf.last_updated,
    nvl2(pf.status, 'статус указан', 'статус не указан') status
from profiles pf
</pre>


<img src="../../img/4_1_nulls/nvl2.png">


<h2 id="coalesce">Coalesce</h2>

<p>
Данная функция принимает на вход любое
количество параметров и возвращает первое,
из них, которое не является <code>NULL</code>:
</p>

<pre>
select login,
       coalesce(status, 'статус пуст') first_not_null,
       coalesce(status, null, null, 'статус пуст') first_not_null_1,
       coalesce('статус всегда заполнен', status) first_not_null_2
from profiles
</pre>

<img src="../../img/4_1_nulls/coalesce.png">

<p>
В том случае, если в функцию <code>COALESCE</code> передаются
параметры разных типов, то все параметры будут
приведены к типу первого <code>NOT NULL</code> аргумента.
</p>

<p>
В том случае, если этого сделать не получится, будет выброшена ошибка:
</p>


<pre>
select coalesce(null, 'String', 'String_2') not_null_str
from dual
</pre>


<img src="../../img/4_1_nulls/coalesce_1.png">

<pre>
select coalesce(null, 'String', 23.4) not_null_str
from dual
</pre>


<img src="../../img/4_1_nulls/coalesce_error.png">

<p>
При этом, если число привести к строке самим, все будет работать, как ожидается:
</p>


<pre>
select coalesce(null, 'String', to_char(23.4)) not_null_str
from dual
</pre>


<img src="../../img/4_1_nulls/coalesce_1.png">
