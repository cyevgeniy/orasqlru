<!--{
    "Title": "Сортировка результатов. Order by",
    "Links": {
        "Next": {
            "Url": "../comparison/index.html",
            "Title": "Оператор WHERE. Операторы сравнения"
        },
        "Prev": {
            "Url": "../scripts/index.html",
            "Title": "Написание SQL- кода"
        }
        }
}-->

<div class="doc-head mb-4 container-10">
    <h5 class="heading-micro heading-muted">Основы</h5>
    <h1 class="heading-huge heading-heavy">Сортировка результатов. Order by</h1>
</div>

<div class="doc-toc mt-6 mb-6">
    <nav class="menu menu-underline menu-medium menu-numbered">
        <ul class="menu-list">
        <li class="menu-item"><a href="#prepare" class="menu-link">Подготовка тестовых данных</a></li>
        <li class="menu-item"><a href="#asc" class="menu-link">Сортировка по возрастанию. Asc</a></li>
        <li class="menu-item"><a href="#desc" class="menu-link">Сортировка по убыванию. Desc</a></li>
        <li class="menu-item"><a href="#default" class="menu-link">Порядок сортировки по-умолчанию</a></li>
        <li class="menu-item"><a href="#bynum" class="menu-link">Сортировка по порядковому номеру</a></li>
        <li class="menu-item"><a href="#nulls" class="menu-link">Nulls last. Nulls first</a></li>
        
        </ul>
    </nav>
</div>

<p>
При выборке данных из БД мы можем сортировать извлекаемые
данные в нужном нам порядке. Использование сортировки
поможет сделать получаемые данные более удобочитаемыми
и воспринимаемыми для анализа человеком.
</p>

<h2 id="prepare">Подготовка тестовых данных</h2>

<p>
Создадим таблицу, которая будет содержать список блюд ресторана:
</p>

<pre>
create table dishes(
    name varchar2(100) not null,
    price number(5,2) not null,
    rating number(5)
);

comment on column dishes.name is 'Наименование блюда';
comment on column dishes.price is 'Стоимость за одну порцию';
comment on column dishes.rating is 'Популярность блюда';

insert into dishes(name, price, rating)
values ('Макароны с сыром', 20.56, 320);

insert into dishes(name, price, rating)
values ('Борщ', 10, 130);

insert into dishes(name, price, rating)
values ('Чай с лимоном', 1.34, 270);

insert into dishes(name, price, rating)
values ('Чай с молоком', 1.20, 280);

insert into dishes(name, price, rating)
values ('Свиная отбивная', 30.50, 320);

insert into dishes(name, price, rating)
values ('Овощной салат', 5.70, null);

</pre>

<p>
Овощной салат - новинка в меню, и его еще не успели оценить посетители;
Именно поэтому в колонке <code>rating</code> содержится <code>null</code>.
Конечно, здесь возможны
варианты - например, можно было хранить значение 0 для обозначения отсутствия
оценок блюда посетителями, но для демонстрационных целей мы здесь будем хранить
<code>null</code>.
</p>

<h2 id="asc">Сортировка по возрастанию. Asc</h2>

<p>
Для того, чтобы получить данные в определенном порядке, используется
конструкция <code>order by</code>. Для того, чтобы сортировка выполнялась по
возрастанию, к конструкции <code>order by</code> добавляется атрибут <code>asc</code>.
</p>

<p>
Получим все блюда в из меню и отсортируем их по стоимости начиная
с дешевых и заканчивая самыми дорогими:
</p>

<pre>
select *
from dishes
order by price asc
</pre>


<img src="../../img/3_select/price_asc.png">

<p>
Сортировка может выполняться одновременно по нескольким полям. Давайте
добавим сортировку по рейтингу блюд начиная от самых непопулярных и
заканчивая самыми популярными блюдами. При этом, кроме рейтинга
мы будем сортировать блюда по стоимости - от дешевых к дорогим:
</p>

<pre>
select *
from dishes
order by rating asc, price asc
</pre>


<img src="../../img/3_select/rating_asc_price_asc.png">

<p>
Как видно, блюда, которые имеют одинаковый рейтинг,
расположились в порядке возрастания их цен.
</p>

<h2 id="desc">Сортировка по убыванию. Desc</h2>

<p>
Для сортировки по убыванию используется
<code>desc</code>.
</p>

<p>
Например, для получения списка блюд начиная от самых популярных и
заканчивая самыми непопулярными, можно написать следующий запрос:
</p>

<pre>
select *
from dishes
order by rating desc
</pre>


<img src="../../img/3_select/rating_desc.png">

<h2 id="default">Порядок сортировки по-умолчанию</h2>

<p>
Если в конструкции order by не указывать порядок сортировки,
то oracle будет производить сортировку по возрастанию.
</p>

<p>
Т.е. следующий запрос:
</p>

<pre>
select *
from dishes
order by price asc, rating asc
</pre>


<p>
Аналогичен следующему:
</p>

<pre>
select *
from dishes
order by price, rating
</pre>


<h2 id="bynum">Сортировка по порядковому номеру</h2>

<p>
Вместо указания колонки, по которой должна производиться сортировка,
можно указать ее порядковый номер в выборке.
Следующие 2 запроса идентичны:
</p>

<pre>
select price, rating
from dishes
order by price, rating
</pre>

<pre>
select price, rating
from dishes
order by 1, 2
</pre>

<p>
Однако, такого подхода следует избегать, и вот почему.
</p>

<p>
Предположим, мы написали следующий запрос:
</p>

<pre>
select name, price
from dishes
order by 2 desc
</pre>

<p>
Этот запрос выводит список блюд начиная
от самых дорогих и заканчивая самыми дешевыми:
</p>

<img src="../../img/3_select/2_desc.png">

<p>
Проходит несколько месяцев, и мы решаем извлекать
кроме наименования блюда и его цены еще и рейтинг.
Пишется следующий запрос:
</p>

<pre>
select name, rating, price
from dishes
order by 2 desc
</pre>


<img src="../../img/3_select/2_desc_v2.png">

<p>
Но эти данные идут не в том порядке, который нам нужен!
Они отсортированы по рейтингу, а не по стоимости. Это
произошло потому, что колонка с ценой теперь третья по счету,
а не вторая, и при добавлении в выборку еще одной колонки
нужно было проверить <code>order by</code> - блок и изменить порядковый
номер для сортировки.
</p>

<h2 id="nulls">Nulls last. Nulls first</h2>

<p>
Сортировка производится по определенным значениям.
Но что делать, если значение в колонке отсутствует, т.е.
в нем содержится <code>null</code>?
</p>

<p>
Здравый смысл подсказывает, что сортировка по null-значениям невозможна.
</p>

<p>
Но мы можем указать, где должны располагаться <code>null</code> -значения при
сортировке в начале или конце. Достигается это путем использования
конструкций <code>nulls last</code> и <code>nulls first</code>. Использование первой
разместит все <code>null</code> - значения в конце, а второй - в начале.
</p>

<pre>
select *
from dishes
order by rating nulls first
</pre>


<img src="../../img/3_select/rating_nulls_first.png">

<pre>
select *
from dishes
order by rating nulls last
</pre>

<img src="../../img/3_select/rating_nulls_last.png">
