<!--{
    "Title": "Виртуальные колонки",
    "Links": {
        "Next": {
            "Url": "../pseudocolumns/index.html",
            "Title": "Псевдостолбцы"
        },
        "Prev": {
            "Url": "../indexes/index.html",
            "Title": "Индексы"
        }
        }
}-->

<div class="doc-head mb-4 container-10">
    <h5 class="heading-micro heading-muted">Объекты БД</h5>
    <h1 class="heading-huge heading-heavy">Виртуальные колонки</h1>
</div>

<div class="doc-toc mt-6 mb-6">
    <nav class="menu menu-underline menu-medium menu-numbered">
        <ul class="menu-list">
        <li class="menu-item"><a href="#createvirtualcolumn" class="menu-link">Создание виртуальных колонок</a></li>
        <li class="menu-item"><a href="#addvirtualcolumn" class="menu-link">Добавление виртуальной колонки к уже существующей таблице</a></li>
        <li class="menu-item"><a href="#whentouse" class="menu-link">Когда использовать виртуальные колонки</a></li>
        </ul>
    </nav>
</div>

<h2 id="createvirtualcolumn"> Создание виртуальных колонок </h2>

<div class="alert alert-info">
<p>Виртуальные колонки
были добавлены в 11 версии Oracle.</p>
</div>

<p>Виртуальные колонки - это колонки, которые
вычисляются на основе других колонок таблицы. Например:</p>

<pre>
create table cars(
	id number primary key,
	model varchar2(100) not null,
	engine_volume number,
	max_speed_km number not null,
	max_speed_ml generated always as
		 (max_speed_km / 1.609));

comment on column cars.max_speed_km is
	'Максимальная скорость, км/ч';
comment on column cars.max_speed_ml is
	'Максимальная скорость, миль/ч';
</pre>

<p>
Здесь максимальная скорость в милях вычисляется
на основании данных о максимальной скорости
автомобиля в километрах.
</p>

<p>Фраза <code>generated always</code> используется
для улучшения читаемости - чтобы было понятнее,
что колонка будет вычисляемой. Объявить колонку
<code>max_speed_ml</code> можно было и без нее:</p>

<pre>
max_speed_ml as (max_speed_km / 1609.344)
</pre>

<p>
Указывать тип данных в колонке необязательно - Oracle
сможет определить его на основании выражения, которое
ее описывает.
</p>

<p>
Когда мы добавляем данные в таблицу,
виртуальные колонки не должны нигде указываться,
т.к. они будут вычислены автоматически:
</p>

<pre>
insert into cars(id, model, engine_volume, max_speed_km)
values(1, 'Tesla', NULL, 250);
</pre>

<p>
Теперь посмотрим на данные в таблице:
</p>

<pre>
| ID | MODEL | ENGINE_VOLUME | MAX_SPEED_KM | MAX_SPEED_ML |
|  1 | Tesla | -             |          250 | 155.37       |
</pre>

<p>
На самом деле значение в вычисляемой колонке будет другим,
т.к. мы не использовали округление при его вычислении. Для
удобства отображения мы оставили лишь 2 знака после запятой.
</p>

<h2 id="addvirtualcolumn"> Добавление виртуальной колонки к уже существующей таблице </h2>

<pre>
alter table cars
add(
	max_speed_m generated always as
		(max_speed_km * 1000)
);
</pre>

<p>
Теперь в таблице хранится и скорость автомобиля в метрах в час:
</p>


<pre>
select id,
       max_speed_km,
       round(max_speed_ml, 2) msm,
       max_speed_m
from cars
</pre>

<pre>
| ID | MAX_SPEED_KM |    MSM | MAX_SPEED_M |
|  1 |          250 | 155.38 |      250000 |
</pre>

<h2 id="whentouse"> Когда использовать виртуальные колонки </h2>

<p>Виртуальные колонки позволяют не использовать
<a href="../views/index.html">представления</a>
в тех случаях, когда колонки,
которые часто
требуются наравне с "чистыми" данными таблицы,
можно вычислить на основании этих самых чистых
данных.</p>

<p>В таком случае ваша схема БД
будет проще - за всеми необходимыми
данными обращаемся напрямую к таблице.</p>




